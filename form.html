<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BCTP - åæ€è¡¨å–®</title>
    <link rel="stylesheet" href="style.css"> 
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“</text></svg>">
    
    <style>
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; }
        .form-group input[type="text"], .form-group textarea {
            width: 100%; padding: 12px; box-sizing: border-box; 
            border: 1px solid #ccc; border-radius: 6px; margin-bottom: 15px;
        }
        .checkbox-group label { display: flex; align-items: center; font-weight: normal; margin-top: 15px; cursor: pointer; }
        .checkbox-group input[type="checkbox"] { width: auto; margin-right: 10px; transform: scale(1.3); }
        .button-footer { display: flex; justify-content: flex-end; gap: 15px; margin-top: 30px; }
        .button-footer button { padding: 12px 25px; font-size: 16px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; min-width: 150px; }
        .submit-button { background-color: #28a745; color: white; }
        .back-button { background-color: #6c757d; color: white; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>BCTP</h1>
            <p>åæ€èˆ‡å¾ŒæœèªçŸ¥è¡¨å–®</p>
        </div>
    </header>

    <main>
        <div class="container">
            <h2>å€‹äººåæ€èˆ‡å¾ŒæœèªçŸ¥</h2>
            
            <p>è«‹é‡å°æ‚¨åœ¨ä¸Šä¸€é æŸ¥è©¢åˆ°çš„æ³•å¾‹å¾Œæœï¼Œå¡«å¯«ä»¥ä¸‹è³‡è¨Šï¼Œä¸¦æäº¤çµ¦å¹³å°ç´€éŒ„ã€‚</p>

            <form id="reflection-form" class="form-card">
                
                <div class="form-group">
                    <label for="school-name">å­¸æ ¡åç¨± (å¿…å¡«)</label>
                    <input type="text" id="school-name" required placeholder="ä¾‹å¦‚ï¼šæŸæŸé«˜è· / æŸæŸåœ‹ä¸­">
                </div>

                <div class="form-group">
                    <label for="student-name">å§“å (å¿…å¡«)</label>
                    <input type="text" id="student-name" required placeholder="è«‹è¼¸å…¥æ‚¨çš„çœŸå¯¦å§“å">
                </div>
                
                <div class="form-group">
                    <label for="reflection-text">åçœå…§å®¹ (å¿…å¡«)</label>
                    <textarea id="reflection-text" required rows="8" 
                        placeholder="è«‹å¯«ä¸‹æ‚¨å°æ–¼å¯èƒ½é¢è‡¨çš„æ³•å¾‹è²¬ä»»ã€è³ å„Ÿçš„çœ‹æ³•èˆ‡æ·±å…¥çš„åçœ..."></textarea>
                </div>
                
                <div class="form-group checkbox-group">
                    <label for="confirmation-checkbox">
                        <input type="checkbox" id="confirmation-checkbox" name="confirmation" required>
                        æˆ‘å·²ç¢ºèªä¸Šè¿°å¡«å¯«çš„è³‡æ–™çš†ç„¡éŒ¯èª¤
                    </label>
                </div>

                <div class="button-footer">
                    <button type="button" class="back-button" onclick="window.location.href='query.html'">è¿”å›æŸ¥è©¢é é¢</button>
                    <button type="submit" id="submit-button" class="submit-button">æäº¤åçœè¡¨å–®</button>
                </div>
            </form>
        </div>
    </main>
    
    <footer>
        <p>BCTP (Bullying Consequence Transparency Platform)</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // *** ğŸš¨ æ›¿æ›é»ï¼šè«‹å°‡æ­¤è™•æ›¿æ›ç‚ºæ‚¨éƒ¨ç½²çš„ Google Apps Script Web App URL ***
            const GAS_URL = 'https://script.google.com/macros/s/AKfycbw4qpHBbdHgLZ62YuDUp1rUg0eeUr__py3PhsfiydmrAQd-t9I9qAEuUl_25sxnwNqghQ/exec'; 
            
            const form = document.getElementById('reflection-form');
            const submitButton = document.getElementById('submit-button');
            const confirmationCheckbox = document.getElementById('confirmation-checkbox');


            form.addEventListener('submit', function(e) {
                
                if (!confirmationCheckbox.checked) {
                    e.preventDefault(); 
                    return; 
                }
                
                e.preventDefault(); 
                
                if (!submitButton) return;
                submitButton.disabled = true;
                submitButton.textContent = 'è³‡æ–™å›å‚³ä¸­...';

                // 1. ç²å–è¡¨å–®æ•¸æ“š
                const school = document.getElementById('school-name').value;
                const studentName = document.getElementById('student-name').value;
                const reflection = document.getElementById('reflection-text').value;
                
                // 2. å¾ Local Storage è®€å–ä¸Šä¸€é çš„è¡Œç‚ºæ•¸æ“š
                const selectedBehaviors = localStorage.getItem('selectedBehaviors') || null; // è¨­ç‚º null

                // 3. æº–å‚™ JSON æ ¼å¼çš„æ•¸æ“š (ç¢ºä¿ key åç¨±æ­£ç¢º)
                const formData = {
                    school: school,
                    studentName: studentName,
                    reflection: reflection,
                    behaviors: selectedBehaviors 
                };
                
                // 4. ä½¿ç”¨ fetch ç™¼é€æ•¸æ“šåˆ° Google Apps Script
                fetch(GAS_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8', 
                    },
                    body: JSON.stringify(formData) 
                })
                .then(response => {
                    alert('âœ¨ è¡¨å–®æäº¤æˆåŠŸï¼æ‚¨çš„åçœæ•¸æ“šå·²æäº¤ã€‚');
                    
                    form.reset();
                    submitButton.textContent = 'âœ… å·²å®Œæˆæäº¤';
                    submitButton.disabled = true;
                    localStorage.removeItem('selectedBehaviors'); 
                })
                .catch(error => {
                    console.error('ç™¼é€æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                    alert('æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Web App URL æˆ–ç¶²è·¯é€£ç·šã€‚');
                    submitButton.textContent = 'æäº¤åçœè¡¨å–®';
                    submitButton.disabled = false;
                });
            });
        });
    </script>
</body>
</html>
