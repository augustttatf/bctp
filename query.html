<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BCTP - è¡Œç‚ºå¾ŒæœæŸ¥è©¢</title>
<link rel="stylesheet" href="style.css">
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ›¡ï¸</text></svg>">
</head>
<body>
<header>
    <div class="container">
        <h1>BCTP</h1>
        <p>éœ¸å‡Œè¡Œç‚ºå¾Œæœé€æ˜åŒ–è³‡è¨Šå¹³å°</p>
    </div>
</header>

<main>
    <div class="container">
        <div id="main-content-wrapper">
            <div class="main-layout-grid">

                <!-- æ­¥é©Ÿä¸€ï¼šè¡Œç‚ºå‹¾é¸ -->
                <div class="filter-panel">
                    <h2>æ­¥é©Ÿä¸€ï¼šè¡Œç‚ºå‹¾é¸</h2>
                    <p>å‹¾é¸è§¸ç™¼æ³•å¾‹å¾Œæœçš„è¡Œç‚ºï¼ŒæŸ¥çœ‹å°æ‡‰çš„æ³•å¾‹å¾Œæœèˆ‡æ¡ˆä¾‹ã€‚</p>
                    <div class="checkbox-group" id="behavior-filters">
                        <label><input type="checkbox" name="behavior" data-type="1" data-name="è‚¢é«”æ¨æ‰“ / é€ æˆè¼•å‚·"> è‚¢é«”æ¨æ‰“ / é€ æˆè¼•å‚·</label>
                        <label><input type="checkbox" name="behavior" data-type="2" data-name="ç¶²è·¯æ•£å¸ƒè¬ è¨€ / æå®³åè­½"> ç¶²è·¯æ•£å¸ƒè¬ è¨€ / æå®³åè­½</label>
                        <label><input type="checkbox" name="behavior" data-type="3" data-name="å¨è„…å–è²¡ / ææ¯€æ”¯ä»˜é‡‘éŒ¢"> å¨è„…å–è²¡ / ææ¯€æ”¯ä»˜é‡‘éŒ¢</label>
                        <label><input type="checkbox" name="behavior" data-type="4" data-name="å¯†é›†è¨Šæ¯é¨·æ“¾ / é€ æˆç²¾ç¥å£“åŠ›"> å¯†é›†è¨Šæ¯é¨·æ“¾ / é€ æˆç²¾ç¥å£“åŠ›</label>
                    </div>
                </div>

                <!-- æ­¥é©ŸäºŒï¼šå¾Œæœè­¦ç¤º -->
                <div class="results-panel">
                    <h2>æ­¥é©ŸäºŒï¼šå¾Œæœè­¦ç¤º (å³æ™‚äº’å‹•)</h2>
                    <p>è«‹åœ¨ä¸Šæ–¹å‹¾é¸è¡Œç‚ºæ¨™ç±¤ï¼Œçµæœå°‡å³æ™‚é¡¯ç¤ºç›¸é—œæ³•å¾‹æ¢æ–‡ã€‚</p>
                    <div id="results-area">
                        <p id="initial-loading-status" class="loading-message" style="text-align:center; font-size:1.1em;">è¼‰å…¥æ³•å¾‹è³‡æ–™ä¸­...</p>
                    </div>
                </div>

                <!-- æ­¥é©Ÿä¸‰ï¼šç›¸é—œæ¡ˆä¾‹ -->
                <div class="case-panel">
                    <h2>æ­¥é©Ÿä¸‰ï¼šç›¸é—œæ¡ˆä¾‹</h2>
                    <p>è«‹åœ¨ä¸Šæ–¹å‹¾é¸è¡Œç‚ºæ¨™ç±¤ï¼ŒæŸ¥çœ‹ç›¸é—œæ–°èæ¡ˆä¾‹ã€‚</p>
                    <div id="case-area"></div>
                </div>
            </div>

            <!-- æŒ‰éˆ•å€å¡Šï¼Œçµ±ä¸€é«˜åº¦ -->
            <div class="button-footer" style="margin-top: 20px; display: flex; gap: 10px;">
                <a href="index.html" class="btn-animated btn-gray">
                    <span class="default-text">â† è¿”å›é¦–é </span>
                    <span class="hover-text">è¿”å›é¦–é </span>
                </a>
                <button id="next-btn" class="btn-animated btn-green">
                    <span class="default-text">ä¸‹ä¸€æ­¥ï¼šå­¸ç¿’å–® â†’</span>
                    <span class="hover-text">ä¸‹ä¸€æ­¥</span>
                </button>
            </div>
        </div>
    </div>
</main>

<footer>
    <p>BCTP (Bullying Consequence Transparency Platform)</p>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const STATUTES_URL = 'https://raw.githubusercontent.com/augustttatf/bctp/refs/heads/main/meowmeowmeow.json';
    const CASES_URL = 'https://raw.githubusercontent.com/augustttatf/bctp/refs/heads/main/newjeans.json';
    
    const mainContentWrapper = document.getElementById('main-content-wrapper');
    const initialLoadingStatus = document.getElementById('initial-loading-status');
    const filterContainer = document.getElementById('behavior-filters');
    const resultsArea = document.getElementById('results-area');
    const caseArea = document.getElementById('case-area'); 
    const checkboxes = filterContainer.querySelectorAll('input[type="checkbox"]');
    const nextBtn = document.getElementById('next-btn');

    let lawData = { related_statutes_segmented: [], LawType_Mapping: {}, cases: [] }; 

    function getLawTypeLabel(law) {
        const lawTypeKey = law.LawType != null ? law.LawType.toString() : '';
        let lawTypeLabel = lawData.LawType_Mapping[lawTypeKey] || 'ç›¸é—œæ³•æ¢';
        if (law.LawType === 0) return `ğŸ›¡ï¸ ${lawTypeLabel}`;
        if (law.LawType === 5) return `ğŸ¤ ${lawTypeLabel}`;
        if (law.ReplenishType === 1) return `âš  ${lawTypeLabel} (å»ºè­°å’Œè§£/è³ å„Ÿ)`; 
        return `ğŸ”— ${lawTypeLabel}`;
    }

    async function loadLawData() {
        try {
            const [statutesResponse, casesResponse] = await Promise.all([
                fetch(STATUTES_URL),
                fetch(CASES_URL)
            ]);
            
            const statutesData = await statutesResponse.json();
            const casesData = await casesResponse.json();

            lawData.related_statutes_segmented = statutesData.related_statutes_segmented || [];
            lawData.LawType_Mapping = statutesData.LawType_Mapping || {};
            lawData.cases = Array.isArray(casesData.news) ? casesData.news : [];

            if (initialLoadingStatus) initialLoadingStatus.remove();
            if (mainContentWrapper) mainContentWrapper.style.display = 'block'; 
            updateResults();
        } catch (error) {
            console.error('è¼‰å…¥æ³•å¾‹è³‡æ–™å¤±æ•—:', error);
            alert('ç¶²ç«™éŒ¯èª¤ï¼šæ ¸å¿ƒè³‡æ–™è¼‰å…¥å¤±æ•—');
            window.location.href = 'index.html';
        }
    }

    function updateResults() {
        resultsArea.innerHTML = ''; 
        caseArea.innerHTML = ''; 
        const selectedLawTypes = new Set();
        const checkedBoxes = Array.from(checkboxes).filter(cb => cb.checked);
        if (checkedBoxes.length === 0) return;
        checkedBoxes.forEach(cb => selectedLawTypes.add(parseInt(cb.getAttribute('data-type'))));

        lawData.related_statutes_segmented.forEach(law => {
            if (selectedLawTypes.has(law.LawType) || law.LawType === 0 || law.LawType === 5) {
                const card = document.createElement('div');
                card.className = 'law-card';
                card.innerHTML = `<h3>${law.LawNum || 'ç„¡æ¢æ¬¾è™Ÿ'}</h3>
                                  <p>${law.LawDetails || 'ç„¡è©³æƒ…'}</p>`;
                resultsArea.appendChild(card);
            }
        });

        const filteredCases = lawData.cases.filter(c => selectedLawTypes.has(parseInt(c.newsType)));
        if (filteredCases.length === 0) {
            caseArea.innerHTML = '<p class="note">ç›®å‰æ²’æœ‰èˆ‡æ‰€é¸è¡Œç‚ºç›¸é—œçš„å…¬é–‹æ¡ˆä¾‹ã€‚</p>';
        } else {
            filteredCases.forEach(c => {
                const card = document.createElement('div');
                card.className = 'case-card';
                card.innerHTML = `<h4>${c.newsTitle || 'ç„¡æ¨™é¡Œ'}</h4>
                                  <p>${c.newscontent || 'ç„¡äº‹ä»¶ç¶“é'}</p>`;
                caseArea.appendChild(card);
            });
        }
    }

    checkboxes.forEach(cb => cb.addEventListener('change', updateResults));

    nextBtn.addEventListener('click', function(){
        const selectedQuestionTypes = Array.from(checkboxes)
            .filter(cb => cb.checked)
            .map(cb => parseInt(cb.getAttribute('data-type')));
        if(selectedQuestionTypes.length === 0){
            alert('è«‹è‡³å°‘å‹¾é¸ä¸€å€‹è¡Œç‚ºï¼Œæ‰èƒ½é€²å…¥å­¸ç¿’å–®ï¼');
            return;
        }
        localStorage.setItem('selectedQuestionTypes', JSON.stringify(selectedQuestionTypes));
        window.location.href = 'quiz.html';
    });

    loadLawData();
});
</script>
</body>
</html>
