<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BCTP - è¡Œç‚ºå¾ŒæœæŸ¥è©¢</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ›¡ï¸</text></svg>">
</head>
<body>
    <header>
        <div class="container">
            <h1>BCTP</h1>
            <p>éœ¸å‡Œè¡Œç‚ºå¾Œæœé€æ˜åŒ–è³‡è¨Šå¹³å°</p>
        </div>
    </header>

    <main>
        <div class="container main-layout">
            
            <div class="filter-panel">
                <h2>æ­¥é©Ÿä¸€ï¼šè¡Œç‚ºå‹¾é¸</h2>
                <p>å‹¾é¸è§¸ç™¼æ³•å¾‹å¾Œæœçš„è¡Œç‚ºï¼ŒæŸ¥çœ‹å°æ‡‰çš„æ³•å¾‹å¾Œæœã€‚</p>

                <div class="checkbox-group" id="behavior-filters">
                    <label><input type="checkbox" name="behavior" value="physical-injury" data-type="1" data-name="è‚¢é«”æ¨æ‰“ / é€ æˆè¼•å‚·"> è‚¢é«”æ¨æ‰“ / é€ æˆè¼•å‚·</label>
                    <label><input type="checkbox" name="behavior" value="online-slander" data-type="2" data-name="ç¶²è·¯æ•£å¸ƒè¬ è¨€ / æå®³åè­½"> ç¶²è·¯æ•£å¸ƒè¬ è¨€ / æå®³åè­½</label>
                    <label><input type="checkbox" name="behavior" value="money-extortion" data-type="3" data-name="å¨è„…å–è²¡ / ææ¯€æ”¯ä»˜é‡‘éŒ¢"> å¨è„…å–è²¡ / ææ¯€æ”¯ä»˜é‡‘éŒ¢</label>
                    <label><input type="checkbox" name="behavior" value="psychological-damage" data-type="4" data-name="å¯†é›†è¨Šæ¯é¨·æ“¾ / é€ æˆç²¾ç¥å£“åŠ›"> å¯†é›†è¨Šæ¯é¨·æ“¾ / é€ æˆç²¾ç¥å£“åŠ›</label>
                </div>
            </div>

            <div class="results-panel">
                <h2>æ­¥é©ŸäºŒï¼šå¾Œæœè­¦ç¤º (å³æ™‚äº’å‹•)</h2>
                <p>è«‹åœ¨å·¦å´å‹¾é¸è¡Œç‚ºæ¨™ç±¤ï¼Œçµæœå°‡å³æ™‚é¡¯ç¤ºç›¸é—œæ³•å¾‹æ¢æ–‡èˆ‡åˆ¤ä¾‹ã€‚</p>

                <div id="results-area">
                    <p id="loading-message">è¼‰å…¥æ³•å¾‹è³‡æ–™ä¸­...</p>
                    </div>
            </div>
            
        </div> 

        <div class="button-footer">
            <a href="form.html" id="next-form-button" class="submit-button">ä¸‹ä¸€æ­¥ï¼šåæ€è¡¨å–® &rarr;</a>
        </div>
    </main>
    
    <footer>
        <p>BCTP (Bullying Consequence Transparency Platform)</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // *** ğŸš¨ å·²æ›¿æ›ç‚ºæ‚¨æä¾›çš„ GitHub Raw JSON é€£çµ ***
            const JSON_URL = 'https://raw.githubusercontent.com/augustttatf/bctp/refs/heads/main/meowmeowmeow.json'; 
            
            const filterContainer = document.getElementById('behavior-filters');
            const resultsArea = document.getElementById('results-area');
            const loadingMessage = document.getElementById('loading-message');
            const checkboxes = filterContainer.querySelectorAll('input[type="checkbox"]');
            
            let lawData = { related_statutes_segmented: [], LawType_Mapping: {} }; 
            let generalLaws = []; 

            localStorage.removeItem('selectedBehaviors');

            // --- è¼‰å…¥ JSON æ•¸æ“š ---
            async function loadLawData() {
                try {
                    const response = await fetch(JSON_URL);
                    if (!response.ok) {
                        throw new Error(`HTTP éŒ¯èª¤! ç‹€æ…‹ç¢¼: ${response.status}`);
                    }
                    const fullData = await response.json();
                    lawData = fullData;

                    // åˆ†é›¢å‡º LawType = 0 çš„é€šç”¨æ³•æ¢
                    generalLaws = lawData.related_statutes_segmented.filter(law => law.LawType === 0);
                    
                    loadingMessage.textContent = 'è¼‰å…¥å®Œæˆï¼Œè«‹å‹¾é¸å·¦å´è¡Œç‚ºã€‚';
                    loadingMessage.style.color = '#28a745';
                    
                    updateResults(); 

                } catch (error) {
                    console.error('è¼‰å…¥æ³•å¾‹è³‡æ–™å¤±æ•—:', error);
                    loadingMessage.textContent = 'âŒ è¼‰å…¥æ³•å¾‹è³‡æ–™å¤±æ•—ï¼Œè«‹æª¢æŸ¥ JSON ç¶²å€æˆ–æ ¼å¼ã€‚';
                    loadingMessage.style.color = 'red';
                }
            }

            // --- æ•¸æ“šæŸ¥æ‰¾èˆ‡é¡¯ç¤ºé‚è¼¯ ---
            function updateResults() {
                resultsArea.innerHTML = ''; 
                const selectedLawTypes = new Set(); 
                let checkedBehaviorNames = []; 

                const checkedBoxes = Array.from(checkboxes).filter(cb => cb.checked);
                
                if (checkedBoxes.length === 0) {
                    resultsArea.appendChild(loadingMessage);
                    loadingMessage.textContent = 'è«‹å‹¾é¸å·¦å´è¡Œç‚ºä»¥æŸ¥çœ‹å°æ‡‰æ³•å¾‹å¾Œæœã€‚';
                    localStorage.removeItem('selectedBehaviors'); 
                    return;
                }
                
                checkedBoxes.forEach(cb => {
                    const type = parseInt(cb.getAttribute('data-type'));
                    const name = cb.getAttribute('data-name');
                    selectedLawTypes.add(type);
                    checkedBehaviorNames.push(name);
                });
                
                // --- é—œéµæ­¥é©Ÿï¼šå°‡å‹¾é¸çš„è¡Œç‚ºåç¨±å„²å­˜åˆ° Local Storage ---
                const selectedBehaviors = checkedBehaviorNames.join('; '); 
                localStorage.setItem('selectedBehaviors', selectedBehaviors);

                if (loadingMessage) loadingMessage.remove(); 
                
                let displayedLawIdentifiers = new Set(); 
                let foundLaws = []; 

                // 1. æŸ¥æ‰¾æ‰€æœ‰èˆ‡å‹¾é¸é¡å‹ç›¸é—œçš„æ³•æ¢
                lawData.related_statutes_segmented.forEach(law => {
                    if (selectedLawTypes.has(law.LawType) && law.LawType !== 0) {
                        const lawIdentifier = `${law.LawType}-${law.LawNum}`;
                        if (!displayedLawIdentifiers.has(lawIdentifier)) {
                            foundLaws.push(law);
                            displayedLawIdentifiers.add(lawIdentifier);
                        }
                    }
                });

                // 2. åŠ å…¥ LawType=0 çš„é€šç”¨æ³•æ¢
                generalLaws.forEach(law => {
                    const lawIdentifier = `${law.LawType}-${law.LawNum}`;
                    if (!displayedLawIdentifiers.has(lawIdentifier)) {
                        foundLaws.push(law);
                        displayedLawIdentifiers.add(lawIdentifier);
                    }
                });


                // 3. æ¸²æŸ“çµæœ
                if (foundLaws.length === 0) {
                     resultsArea.innerHTML = `<p style="color: red;">æŠ±æ­‰ï¼Œç›®å‰è³‡æ–™åº«ä¸­æœªæ‰¾åˆ°èˆ‡æ‚¨å‹¾é¸è¡Œç‚ºç›¸é—œçš„æ³•å¾‹æ¢æ–‡ã€‚</p>`;
                     return;
                }
                
                foundLaws.forEach(law => {
                    const card = document.createElement('div');
                    card.className = 'law-card'; 
                    
                    let lawTypeLabel = law.LawType === 0 ? 'å°‘å¹´äº‹ä»¶è™•ç†æ³• (é€šç”¨è™•åˆ†)' : lawData.LawType_Mapping[law.LawType.toString()] || 'ç›¸é—œæ³•æ¢';
                    
                    let html = `<h3>${lawTypeLabel} - ${law.LawNum || 'ç„¡æ¢æ¬¾è™Ÿ'}</h3>`;
                    html += `<p><strong>æ¢æ–‡è©³æƒ…ï¼š</strong> ${law.LawDetails || 'ç„¡è©³æƒ…'}</p>`;
                    html += `<p class="note"><strong>(ç›¸é—œèªªæ˜)</strong> ${law.RelevanceNote || 'ç„¡ç›¸é—œæ€§èªªæ˜'}</p>`;
                    
                    card.innerHTML = html;
                    resultsArea.appendChild(card);
                });
                
            }

            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateResults);
            });
            
            loadLawData();
        });
    </script>
</body>
</html>
