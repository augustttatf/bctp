<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BCTP - è¡Œç‚ºå¾ŒæœæŸ¥è©¢</title>
<link rel="stylesheet" href="style.css">
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ›¡ï¸</text></svg>">
</head>
<body>

<header>
    <div class="container">
        <h1>BCTP</h1>
        <p>éœ¸å‡Œè¡Œç‚ºå¾Œæœé€æ˜åŒ–è³‡è¨Šå¹³å°</p>
    </div>
</header>

<main>
<div class="container">

<div id="main-content-wrapper" style="display:none;"> 

<div class="main-layout-grid"> 

<!-- ------------------ æ­¥é©Ÿä¸€ï¼šå‹¾é¸ ------------------ -->
<div class="filter-panel">
    <h2>æ­¥é©Ÿä¸€ï¼šè¡Œç‚ºå‹¾é¸</h2>
    <p>å‹¾é¸è§¸ç™¼æ³•å¾‹å¾Œæœçš„è¡Œç‚ºï¼ŒæŸ¥çœ‹å°æ‡‰çš„æ³•å¾‹å¾Œæœèˆ‡æ¡ˆä¾‹ã€‚</p>

    <div class="checkbox-group" id="behavior-filters">
        <label><input type="checkbox" name="behavior" value="physical-injury" data-type="1" data-name="è‚¢é«”æ¨æ‰“ / é€ æˆè¼•å‚·"> è‚¢é«”æ¨æ‰“ / é€ æˆè¼•å‚·</label>
        <label><input type="checkbox" name="behavior" value="online-slander" data-type="2" data-name="ç¶²è·¯æ•£å¸ƒè¬ è¨€ / æå®³åè­½"> ç¶²è·¯æ•£å¸ƒè¬ è¨€ / æå®³åè­½</label>
        <label><input type="checkbox" name="behavior" value="money-extortion" data-type="3" data-name="å¨è„…å–è²¡ / ææ¯€æ”¯ä»˜é‡‘éŒ¢"> å¨è„…å–è²¡ / ææ¯€æ”¯ä»˜é‡‘éŒ¢</label>
        <label><input type="checkbox" name="behavior" value="psychological-damage" data-type="4" data-name="å¯†é›†è¨Šæ¯é¨·æ“¾ / é€ æˆç²¾ç¥å£“åŠ›"> å¯†é›†è¨Šæ¯é¨·æ“¾ / é€ æˆç²¾ç¥å£“åŠ›</label>
    </div>
</div>


<!-- ------------------ æ­¥é©ŸäºŒï¼šæ³•å¾‹å¾Œæœ ------------------ -->
<div class="results-panel">
    <h2>æ­¥é©ŸäºŒï¼šå¾Œæœè­¦ç¤º (å³æ™‚äº’å‹•)</h2>
    <p>è«‹åœ¨ä¸Šæ–¹å‹¾é¸è¡Œç‚ºæ¨™ç±¤ï¼Œçµæœå°‡å³æ™‚é¡¯ç¤ºç›¸é—œæ³•å¾‹æ¢æ–‡ã€‚</p>
    <div id="results-area">
        <p id="initial-loading-status" class="loading-message" style="text-align:center; font-size:1.1em;">è¼‰å…¥æ³•å¾‹è³‡æ–™ä¸­...</p>
    </div>
</div>


<!-- ------------------ æ­¥é©Ÿä¸‰ï¼šæ¡ˆä¾‹ ------------------ -->
<div class="case-panel">
    <h2>æ­¥é©Ÿä¸‰ï¼šç›¸é—œæ¡ˆä¾‹</h2>
    <p>è«‹åœ¨ä¸Šæ–¹å‹¾é¸è¡Œç‚ºæ¨™ç±¤ï¼ŒæŸ¥çœ‹ç›¸é—œæ–°èæ¡ˆä¾‹ã€‚</p>
    <div id="case-area"></div>
</div>

</div> <!-- END GRID -->


<!-- ------------------ æŒ‰éˆ•å€å¡Šï¼ˆå®Œå…¨ä¿ç•™ä½ çš„å¸ƒå±€ï¼‰ ------------------ -->
<div class="button-footer">
    
    <a href="index.html" class="btn-animated btn-gray">
        <span class="default-text">â† è¿”å›é¦–é </span>
        <span class="hover-text">è¿”å›é¦–é </span>
    </a>

    <button id="next-btn" class="btn-animated btn-green">
        <span class="default-text">ä¸‹ä¸€æ­¥ï¼šå­¸ç¿’å–® â†’</span>
        <span class="hover-text">ä¸‹ä¸€æ­¥</span>
    </button>

</div>

</div> <!-- main-content-wrapper -->
</div> <!-- container -->
</main>

<footer>
<p>BCTP (Bullying Consequence Transparency Platform)</p>
</footer>


<!-- ============================================================
     å®Œæ•´ JSï¼ˆå·²ä¿®å¥½æ‰€æœ‰å•é¡Œã€å¯ç›´æ¥éŠœæ¥ quiz.htmlï¼‰
     ============================================================ -->
<script>
document.addEventListener('DOMContentLoaded', function() {

const STATUTES_URL = 'https://raw.githubusercontent.com/augustttatf/bctp/refs/heads/main/meowmeowmeow.json';
const CASES_URL    = 'https://raw.githubusercontent.com/augustttatf/bctp/refs/heads/main/newjeans.json';

const mainContentWrapper = document.getElementById('main-content-wrapper');
const initialLoadingStatus = document.getElementById('initial-loading-status');
const filterContainer = document.getElementById('behavior-filters');
const checkboxes = filterContainer.querySelectorAll('input[type="checkbox"]');
const resultsArea = document.getElementById('results-area');
const caseArea = document.getElementById('case-area');
const nextBtn = document.getElementById('next-btn');

const FATAL_ERROR_MESSAGE = 'ç¶²ç«™éŒ¯èª¤ï¼šè³‡æ–™è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚';

let lawData = {
    related_statutes_segmented: [],
    LawType_Mapping: {},
    cases: []
};

/* ------------------- LawType é¡åˆ¥æ¨™ç±¤ ------------------- */
function getLawTypeLabel(law) {
    const key = law.LawType != null ? law.LawType.toString() : "";
    let label = lawData.LawType_Mapping[key] || "ç›¸é—œæ³•æ¢";

    if (law.LawType === 0) return `ğŸ›¡ï¸ ${label}`;
    if (law.LawType === 5) return `ğŸ¤ ${label}`;
    if (law.ReplenishType === 1) return `âš  ${label} (å»ºè­°å’Œè§£/è³ å„Ÿ)`;

    return `ğŸ”— ${label}`;
}

/* ------------------- è³‡æ–™è¼‰å…¥ ------------------- */
async function loadLawData() {
    try {
        const [statutesRes, casesRes] = await Promise.all([
            fetch(STATUTES_URL),
            fetch(CASES_URL)
        ]);

        if (!statutesRes.ok) throw new Error("æ³•æ¢è¼‰å…¥å¤±æ•—");
        if (!casesRes.ok) throw new Error("æ¡ˆä¾‹è¼‰å…¥å¤±æ•—");

        const statutes = await statutesRes.json();
        const cases = await casesRes.json();

        lawData.related_statutes_segmented = statutes.related_statutes_segmented || [];
        lawData.LawType_Mapping = statutes.LawType_Mapping || {};
        lawData.cases = Array.isArray(cases.news) ? cases.news : [];

        initialLoadingStatus.remove();
        mainContentWrapper.style.display = "block";

        updateResults();

    } catch (err) {
        console.error(err);
        alert(FATAL_ERROR_MESSAGE);
        window.location.href = "index.html";
    }
}

/* ------------------- ç”¢ç”Ÿæ³•æ¢å¡ç‰‡ ------------------- */
function createLawCard(lawGroup) {
    const card = document.createElement("div");
    card.className = `law-card ${lawGroup.isSupplementCategory ? "replenish-content" : ""}`;

    let html = `
        <h3 class="law-num-title">${lawGroup.LawNum || "ç„¡æ¢æ–‡ç·¨è™Ÿ"}</h3>
        <p class="law-details"><strong>æ¢æ–‡è©³æƒ…ï¼š</strong> ${lawGroup.LawDetails || "ç„¡è©³æƒ…"}</p>
        <ul class="combined-relevance-list">
    `;

    lawGroup.combinedNotes.forEach(note => {
        html += `<li><strong>${getLawTypeLabel(note)}ï¼š</strong> ${note.RelevanceNote}</li>`;
    });

    html += "</ul>";
    card.innerHTML = html;
    return card;
}

/* ------------------- ç”¢ç”Ÿæ¡ˆä¾‹å¡ç‰‡ ------------------- */
function createCaseCard(c) {
    const card = document.createElement("div");
    card.className = "case-card";

    let html = `
        <h4 class="case-title">${c.newsTitle}</h4>
        <p class="case-content"><strong>äº‹ä»¶ç¶“éï¼š</strong>${c.newscontent}</p>
    `;

    if (c.source) {
        html += `<p><strong>æ–°èä¾†æºï¼š</strong><a href="${c.source}" target="_blank">æŸ¥çœ‹</a></p>`;
    }

    if (c.videoconnection) {
        const yt = c.videoconnection.match(/(?:youtu\.be\/|v=)([\w-]+)/);
        if (yt) {
            html += `<iframe src="https://www.youtube.com/embed/${yt[1]}" frameborder="0" allowfullscreen></iframe>`;
        }
    }

    card.innerHTML = html;
    return card;
}

/* ------------------- å‹¾é¸ â†’ æ›´æ–°ç•«é¢ ------------------- */
function updateResults() {
    resultsArea.innerHTML = "";
    caseArea.innerHTML = "";

    const selectedTypes = new Set();
    let behaviorNames = [];

    const checked = Array.from(checkboxes).filter(cb => cb.checked);
    if (checked.length === 0) return;

    checked.forEach(cb => {
        selectedTypes.add(parseInt(cb.dataset.type));
        behaviorNames.push("* " + cb.dataset.name);
    });

    localStorage.setItem("selectedBehaviorNames", behaviorNames.join("\n"));

    let grouped = {};

    lawData.related_statutes_segmented.forEach(law => {
        const hit = selectedTypes.has(law.LawType) || law.LawType === 0 || law.LawType === 5;
        if (!hit) return;

        if (!grouped[law.LawNum]) {
            grouped[law.LawNum] = {
                ...law,
                combinedNotes: [],
                isSupplementCategory: law.LawType === 5 || law.ReplenishType === 1
            };
        }

        grouped[law.LawNum].combinedNotes.push({
            LawType: law.LawType,
            ReplenishType: law.ReplenishType,
            RelevanceNote: law.RelevanceNote
        });
    });

    const core = Object.values(grouped).filter(l => !l.isSupplementCategory);
    const sup = Object.values(grouped).filter(l => l.isSupplementCategory);

    if (core.length > 0) {
        let t = document.createElement("h3");
        t.textContent = "ğŸ›¡ï¸ æ ¸å¿ƒç›¸é—œæ³•æ¢ï¼š";
        resultsArea.appendChild(t);

        core.forEach(l => resultsArea.appendChild(createLawCard(l)));
    }

    if (sup.length > 0) {
        let t = document.createElement("h3");
        t.textContent = "âš–ï¸ å”å•†èˆ‡è£œå……æ³•æ¢ï¼š";
        resultsArea.appendChild(t);

        sup.forEach(l => resultsArea.appendChild(createLawCard(l)));
    }

    const relatedCases = lawData.cases.filter(c => selectedTypes.has(parseInt(c.newsType)));

    if (relatedCases.length === 0) {
        caseArea.innerHTML = "<p class='note'>ç›®å‰æ²’æœ‰ç›¸é—œå…¬é–‹æ¡ˆä¾‹ã€‚</p>";
    } else {
        relatedCases.forEach(c => caseArea.appendChild(createCaseCard(c)));
    }
}

/* ------------------ Checkbox ç¶å®š ------------------ */
checkboxes.forEach(cb => cb.addEventListener("change", updateResults));

/* ------------------ ä¸‹ä¸€æ­¥ â†’ quiz.html ------------------ */
nextBtn.addEventListener("click", function () {
    const selected = Array.from(checkboxes)
        .filter(cb => cb.checked)
        .map(cb => ({
            value: cb.value,
            name: cb.dataset.name,
            type: cb.dataset.type
        }));

    if (selected.length === 0) {
        alert("è«‹è‡³å°‘å‹¾é¸ä¸€å€‹è¡Œç‚ºï¼");
        return;
    }

    localStorage.setItem("selected_behaviors", JSON.stringify(selected));

    window.location.href = "quiz.html";
});

loadLawData();

});
</script>

</body>
</html>
