<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BCTP - è¡Œç‚ºå¾ŒæœæŸ¥è©¢</title>
<link rel="stylesheet" href="style.css">
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ›¡ï¸</text></svg>">
<style>
    #main-content-wrapper { display: none; }
</style>
</head>
<body>
<header>
    <div class="container">
        <h1>BCTP</h1>
        <p class="subtitle">éœ¸å‡Œè¡Œç‚ºå¾Œæœé€æ˜åŒ–è³‡è¨Šå¹³å°</p>
    </div>
</header>

<main>
<div class="container">
    <div id="main-content-wrapper">
        <div class="main-layout-grid">

            <!-- ç¯©é¸å€ -->
            <div class="filter-panel">
                <h2>æ­¥é©Ÿä¸€ï¼šè¡Œç‚ºå‹¾é¸</h2>
                <p>å‹¾é¸è§¸ç™¼æ³•å¾‹å¾Œæœçš„è¡Œç‚ºï¼ŒæŸ¥çœ‹å°æ‡‰çš„æ³•å¾‹å¾Œæœèˆ‡æ¡ˆä¾‹ã€‚</p>
                <div class="checkbox-group" id="behavior-filters">
                    <label><input type="checkbox" name="behavior" value="physical-injury" data-type="1" data-name="è‚¢é«”æ¨æ‰“ / é€ æˆè¼•å‚·"> è‚¢é«”æ¨æ‰“ / é€ æˆè¼•å‚·</label>
                    <label><input type="checkbox" name="behavior" value="online-slander" data-type="2" data-name="ç¶²è·¯æ•£å¸ƒè¬ è¨€ / æå®³åè­½"> ç¶²è·¯æ•£å¸ƒè¬ è¨€ / æå®³åè­½</label>
                    <label><input type="checkbox" name="behavior" value="money-extortion" data-type="3" data-name="å¨è„…å–è²¡ / ææ¯€æ”¯ä»˜é‡‘éŒ¢"> å¨è„…å–è²¡ / ææ¯€æ”¯ä»˜é‡‘éŒ¢</label>
                    <label><input type="checkbox" name="behavior" value="psychological-damage" data-type="4" data-name="å¯†é›†è¨Šæ¯é¨·æ“¾ / é€ æˆç²¾ç¥å£“åŠ›"> å¯†é›†è¨Šæ¯é¨·æ“¾ / é€ æˆç²¾ç¥å£“åŠ›</label>
                </div>
            </div>

            <!-- æ³•æ¢çµæœ -->
            <div class="results-panel">
                <h2>æ­¥é©ŸäºŒï¼šå¾Œæœè­¦ç¤º (å³æ™‚äº’å‹•)</h2>
                <p>è«‹åœ¨ä¸Šæ–¹å‹¾é¸è¡Œç‚ºæ¨™ç±¤ï¼Œçµæœå°‡å³æ™‚é¡¯ç¤ºç›¸é—œæ³•å¾‹æ¢æ–‡ã€‚</p>
                <div id="results-area"></div>
            </div>

            <!-- æ¡ˆä¾‹å€ -->
            <div class="case-panel">
                <h2>æ­¥é©Ÿä¸‰ï¼šç›¸é—œæ¡ˆä¾‹</h2>
                <p>è«‹åœ¨ä¸Šæ–¹å‹¾é¸è¡Œç‚ºæ¨™ç±¤ï¼ŒæŸ¥çœ‹ç›¸é—œæ–°èæ¡ˆä¾‹ã€‚</p>
                <div id="case-area"></div>
            </div>

        </div>

        <div class="button-footer">
            <a href="form.html" class="submit-button">ä¸‹ä¸€æ­¥ï¼šåæ€è¡¨å–® &rarr;</a>
        </div>
    </div>

    <p id="initial-loading-status" class="loading-message" style="text-align:center; font-size:1.1em;">è¼‰å…¥æ³•å¾‹è³‡æ–™ä¸­...</p>
</div>
</main>

<footer>
    <p>BCTP (Bullying Consequence Transparency Platform)</p>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const STATUTES_URL = 'https://raw.githubusercontent.com/augustttatf/bctp/refs/heads/main/meowmeowmeow.json';
    const CASES_URL = 'https://raw.githubusercontent.com/augustttatf/bctp/refs/heads/main/newjeans.json';

    const mainContentWrapper = document.getElementById('main-content-wrapper');
    const initialLoadingStatus = document.getElementById('initial-loading-status');
    const filterContainer = document.getElementById('behavior-filters');
    const resultsArea = document.getElementById('results-area');
    const caseArea = document.getElementById('case-area'); 
    const checkboxes = filterContainer.querySelectorAll('input[type="checkbox"]');

    let lawData = { related_statutes_segmented: [], LawType_Mapping: {}, news: [] };

    function getLawTypeLabel(law) {
        const key = law.LawType != null ? law.LawType.toString() : '';
        const label = lawData.LawType_Mapping[key] || 'ç›¸é—œæ³•æ¢';
        if (law.LawType === 0) return `ğŸ›¡ï¸ ${label}`;
        if (law.LawType === 5) return `ğŸ¤ ${label}`;
        if (law.ReplenishType === 1) return `âš  ${label} (å»ºè­°å’Œè§£/è³ å„Ÿ)`;
        return `ğŸ”— ${label}`;
    }

    async function loadLawData() {
        try {
            const [statutesResponse, casesResponse] = await Promise.all([fetch(STATUTES_URL), fetch(CASES_URL)]);
            const statutesData = await statutesResponse.json();
            const casesData = await casesResponse.json();

            lawData.related_statutes_segmented = statutesData.related_statutes_segmented || [];
            lawData.LawType_Mapping = statutesData.LawType_Mapping || {};
            lawData.news = Array.isArray(casesData.news) ? casesData.news : [];

            if (initialLoadingStatus) initialLoadingStatus.remove();
            if (mainContentWrapper) mainContentWrapper.style.display = 'block';
            updateResults();
        } catch (error) {
            console.error('è¼‰å…¥å¤±æ•—:', error);
            alert('ç¶²ç«™éŒ¯èª¤ï¼šæ ¸å¿ƒè³‡æ–™è¼‰å…¥å¤±æ•—ï¼Œå³å°‡è¿”å›é¦–é ');
            window.location.href = 'index.html';
        }
    }

    function createLawCard(lawGroup) {
        const card = document.createElement('div');
        card.className = 'law-card';
        let html = `<h3 class="law-num-title">${lawGroup.LawNum || 'ç„¡æ¢æ¬¾è™Ÿ'}</h3>`;
        html += `<p class="law-details">${lawGroup.LawDetails || 'ç„¡è©³æƒ…'}</p>`;
        if(lawGroup.RelevanceNote) html += `<p class="relevance-note">èªªæ˜ï¼š${lawGroup.RelevanceNote}</p>`;
        card.innerHTML = html;
        return card;
    }

    function createCaseCard(caseItem) {
        const card = document.createElement('div');
        card.className = 'case-card';
        let html = `<h4 class="case-title">${caseItem.newsTitle || 'ç„¡æ¡ˆä¾‹æ¨™é¡Œ'}</h4>`;
        html += `<p class="case-content">${caseItem.newscontent || 'ç„¡äº‹ä»¶ç¶“é'}</p>`;
        if (caseItem.source) {
            html += `<p class="case-source"><a href="${caseItem.source}" target="_blank" rel="noopener noreferrer">æŸ¥çœ‹æ–°èä¾†æº</a></p>`;
        }
        if (caseItem.videoconnection) {
            const youtube = caseItem.videoconnection.match(/(?:youtube\.com\/.*v=|youtu\.be\/)([\w-]+)/);
            if (youtube && youtube[1]) {
                html += `<div class="video-container"><iframe src="https://www.youtube.com/embed/${youtube[1]}" frameborder="0" allowfullscreen></iframe></div>`;
            }
        }
        card.innerHTML = html;
        return card;
    }

    function updateResults() {
        resultsArea.innerHTML = '';
        caseArea.innerHTML = '';

        const selectedTypes = Array.from(checkboxes)
            .filter(cb => cb.checked)
            .map(cb => parseInt(cb.getAttribute('data-type')));

        if (selectedTypes.length === 0) return;

        // é¡¯ç¤ºæ³•å¾‹æ¢æ–‡
        const filteredLaws = lawData.related_statutes_segmented.filter(law => selectedTypes.includes(law.LawType));
        if (filteredLaws.length === 0) {
            const note = document.createElement('p');
            note.className = 'note';
            note.textContent = 'ç›®å‰æ²’æœ‰èˆ‡æ‰€é¸è¡Œç‚ºç›¸é—œçš„æ³•æ¢ã€‚';
            resultsArea.appendChild(note);
        } else {
            filteredLaws.forEach(law => resultsArea.appendChild(createLawCard(law)));
        }

        // é¡¯ç¤ºæ¡ˆä¾‹
        const matchedCases = lawData.news.filter(item => selectedTypes.includes(item.newsType));
        if (matchedCases.length === 0) {
            const note = document.createElement('p');
            note.className = 'note';
            note.textContent = 'ç›®å‰æ²’æœ‰èˆ‡æ‰€é¸è¡Œç‚ºç›¸é—œçš„å…¬é–‹æ¡ˆä¾‹ã€‚';
            caseArea.appendChild(note);
        } else {
            matchedCases.forEach(item => caseArea.appendChild(createCaseCard(item)));
        }
    }

    checkboxes.forEach(cb => cb.addEventListener('change', updateResults));
    loadLawData();
});
</script>
</body>
</html>
